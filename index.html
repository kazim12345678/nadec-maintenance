<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>NADEC Maintenance Breakdown Tracker</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #f4f6f9;
    }

    header {
      background: #003366;
      color: white;
      padding: 15px;
      text-align: center;
      font-size: 20px;
    }

    .container {
      padding: 15px;
      max-width: 1100px;
      margin: auto;
    }

    button {
      padding: 10px 14px;
      margin: 6px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
    }

    .btn-upload { background: #007bff; color: white; }
    .btn-add { background: #28a745; color: white; }
    .btn-export { background: #ff9800; color: white; }
    .btn-delete { background: crimson; color: white; }
    .btn-edit { background: purple; color: white; }

    .hidden { display: none; }

    table {
      width: 100%;
      margin-top: 15px;
      border-collapse: collapse;
      background: white;
      font-size: 14px;
    }

    th {
      background: #003366;
      color: white;
      padding: 8px;
    }

    td {
      padding: 8px;
      border-bottom: 1px solid #ddd;
      text-align: center;
    }

    .timeline {
      margin-top: 25px;
      background: white;
      padding: 15px;
      border-radius: 10px;
    }

    .machine-row {
      margin: 10px 0;
    }

    .machine-title {
      font-weight: bold;
      margin-bottom: 5px;
    }

    .bar {
      height: 18px;
      border-radius: 6px;
      display: inline-block;
      margin-right: 4px;
      cursor: pointer;
    }

    .Mechanical { background: red; }
    .Electrical { background: blue; }
    .Automation { background: green; }

    @media(max-width:768px){
      table { font-size: 12px; }
      .bar { height: 14px; }
    }
  </style>
</head>

<body>

<header>
  NADEC Real-Time Maintenance Breakdown Dashboard
</header>

<div class="container">

  <!-- Upload CSV -->
  <input type="file" id="csvFile" accept=".csv" hidden>
  <button class="btn-upload" onclick="document.getElementById('csvFile').click()">
    ðŸ“‚ Upload CSV
  </button>

  <!-- Toggle Form -->
  <button class="btn-add" onclick="toggleForm()">
    âž• Add Breakdown Entry
  </button>

  <button class="btn-export" onclick="exportCSV()">
    ðŸ“¥ Export Updated CSV
  </button>

  <!-- Hidden Form -->
  <div id="entryForm" class="hidden">
    <h3>Add Breakdown</h3>

    Date: <input type="date" id="date"><br><br>

    Machine:
    <select id="machine">
      <option>M1</option><option>M2</option><option>M3</option>
      <option>M4</option><option>M5</option><option>M6</option>
      <option>M7</option><option>M8</option><option>M9</option>
      <option>M10</option><option>M11</option><option>M12</option>
      <option>M13</option><option>M14</option><option>M15</option>
      <option>M16</option><option>M17</option><option>M18</option>
    </select><br><br>

    Time (minutes): <input type="number" id="time"><br><br>

    Reason:
    <select id="reason">
      <option>Mechanical</option>
      <option>Electrical</option>
      <option>Automation</option>
    </select><br><br>

    Technician: <input type="text" id="tech"><br><br>

    <button class="btn-add" onclick="addEntry()">Save Entry</button>
  </div>

  <!-- Data Table -->
  <h3>ðŸ“‹ Breakdown Log</h3>
  <table id="dataTable">
    <thead>
      <tr>
        <th>Date</th>
        <th>Machine</th>
        <th>Time</th>
        <th>Reason</th>
        <th>Technician</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- Timeline -->
  <div class="timeline">
    <h3>ðŸ“Š Machine Breakdown Timeline (CUTE View)</h3>
    <div id="timelineView"></div>
  </div>

</div>

<script>
  let breakdownData = JSON.parse(localStorage.getItem("breakdowns")) || [];

  function toggleForm() {
    document.getElementById("entryForm").classList.toggle("hidden");
  }

  function saveData() {
    localStorage.setItem("breakdowns", JSON.stringify(breakdownData));
    renderTable();
    renderTimeline();
  }

  function addEntry() {
    let entry = {
      date: document.getElementById("date").value,
      machine: document.getElementById("machine").value,
      time: document.getElementById("time").value,
      reason: document.getElementById("reason").value,
      tech: document.getElementById("tech").value
    };

    breakdownData.push(entry);
    saveData();
  }

  function deleteEntry(index) {
    breakdownData.splice(index, 1);
    saveData();
  }

  function editEntry(index) {
    let e = breakdownData[index];

    document.getElementById("date").value = e.date;
    document.getElementById("machine").value = e.machine;
    document.getElementById("time").value = e.time;
    document.getElementById("reason").value = e.reason;
    document.getElementById("tech").value = e.tech;

    deleteEntry(index);
    toggleForm();
  }

  function renderTable() {
    let tbody = document.querySelector("#dataTable tbody");
    tbody.innerHTML = "";

    breakdownData.forEach((e, i) => {
      tbody.innerHTML += `
        <tr>
          <td>${e.date}</td>
          <td>${e.machine}</td>
          <td>${e.time} min</td>
          <td>${e.reason}</td>
          <td>${e.tech}</td>
          <td>
            <button class="btn-edit" onclick="editEntry(${i})">Edit</button>
            <button class="btn-delete" onclick="deleteEntry(${i})">Delete</button>
          </td>
        </tr>
      `;
    });
  }

  function renderTimeline() {
    let view = document.getElementById("timelineView");
    view.innerHTML = "";

    let machines = [...new Set(breakdownData.map(x => x.machine))];

    machines.forEach(m => {
      let machineEvents = breakdownData.filter(x => x.machine === m);

      let row = `<div class="machine-row">
        <div class="machine-title">${m}</div>`;

      machineEvents.forEach(ev => {
        row += `<div class="bar ${ev.reason}"
          style="width:${ev.time}px"
          onclick="alert('Machine: ${m}\\nReason: ${ev.reason}\\nTime: ${ev.time} min\\nTechnician: ${ev.tech}')">
        </div>`;
      });

      row += "</div>";
      view.innerHTML += row;
    });
  }

  function exportCSV() {
    let csv = "Date,Machine,Time,Reason,Technician\n";

    breakdownData.forEach(e => {
      csv += `${e.date},${e.machine},${e.time},${e.reason},${e.tech}\n`;
    });

    let blob = new Blob([csv], { type: "text/csv" });
    let link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "breakdown_data.csv";
    link.click();
  }

  // Load Dashboard
  renderTable();
  renderTimeline();
</script>

</body>
</html>

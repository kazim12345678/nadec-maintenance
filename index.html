<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Plant Maintenance Command Center</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{
    margin:0;
    font-family:Segoe UI,Arial;
    background:#0f172a;
    color:#e2e8f0;
}
header{
    padding:20px;
    text-align:center;
    background:#111827;
    font-size:24px;
    font-weight:600;
    letter-spacing:1px;
}
.section{
    padding:25px;
}
.grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
    gap:20px;
}
.card{
    background:#1e293b;
    padding:20px;
    border-radius:12px;
    box-shadow:0 0 15px rgba(0,0,0,0.4);
}
.card h3{
    margin:0 0 10px;
    font-size:15px;
    color:#94a3b8;
}
.card .value{
    font-size:28px;
    font-weight:700;
}
canvas{
    background:#1e293b;
    padding:15px;
    border-radius:12px;
}
table{
    width:100%;
    border-collapse:collapse;
    margin-top:20px;
}
th,td{
    padding:10px;
    text-align:center;
    border-bottom:1px solid #334155;
}
th{
    background:#1e293b;
}
.highlight{
    color:#facc15;
}
.warning{
    color:#ef4444;
}
.success{
    color:#22c55e;
}
</style>
</head>
<body>

<header>Plant Maintenance Intelligence Command Center</header>

<div class="section">
<div class="grid" id="kpiCards"></div>
</div>

<div class="section">
<h2>Shift & Area Distribution</h2>
<div class="grid">
<canvas id="shiftChart"></canvas>
<canvas id="areaChart"></canvas>
</div>
</div>

<div class="section">
<h2>Hourly Breakdown Trend</h2>
<canvas id="hourChart"></canvas>
</div>

<div class="section">
<h2>Technician Performance Analysis</h2>
<canvas id="techStackChart"></canvas>
<div id="techTable"></div>
</div>

<div class="section">
<h2>Executive Insights</h2>
<div class="card" id="insightBox"></div>
</div>

<script>
function timeToDecimal(t){
    if(!t || t==="") return 0;
    let parts=t.split(":");
    return parseInt(parts[0]) + (parseInt(parts[1])/60);
}
function decimalToTime(d){
    let h=Math.floor(d);
    let m=Math.round((d-h)*60);
    return h+":"+String(m).padStart(2,'0');
}

/* ---------------- SHIFT DATA ---------------- */
const shiftData={
    "Day":642,
    "Night":703
};

/* ---------------- AREA DATA ---------------- */
const areaData={
    "Crates Area":89,
    "Downline":447,
    "Filling & Capping":681,
    "Upstream":128
};

/* ---------------- HOUR DATA ---------------- */
const hourData={
0:"19:59",1:"28:00",2:"21:43",3:"21:21",4:"23:21",5:"5:14",
6:"20:42",7:"53:39",8:"21:34",9:"20:24",10:"21:31",11:"6:48",
12:"17:25",13:"31:42",14:"26:16",15:"31:08",16:"14:31",
17:"13:39",18:"33:21",19:"6:13",20:"29:51",21:"26:19",
22:"30:06",23:"24:51"
};

/* ---------------- TECHNICIAN RAW DATA ---------------- */
const techRaw=[
{name:"ali",bd:"41:09",corr:"38:08"},
{name:"amgad",bd:"22:51",corr:"26:45"},
{name:"dante",bd:"54:20",corr:"65:29"},
{name:"day shift maint. team",bd:"69:05",corr:"25:16"},
{name:"edgar",bd:"42:32",corr:"30:41"},
{name:"gilbert",bd:"37:27",corr:"27:53"},
{name:"husam",bd:"41:03",corr:"48:30"},
{name:"jamal",bd:"18:35",corr:"15:12"},
{name:"lito",bd:"15:29",corr:"13:10"},
{name:"moneef",bd:"20:12",corr:"17:31"},
{name:"nashwan",bd:"46:21",corr:"66:53"},
{name:"night shift maint. team",bd:"55:09",corr:"18:55"},
{name:"sameer",bd:"32:02",corr:"30:26"},
{name:"sami",bd:"29:12",corr:"25:09"}
];

/* ---------------- CALCULATIONS ---------------- */
let totalShift=shiftData.Day+shiftData.Night;
let totalArea=Object.values(areaData).reduce((a,b)=>a+b,0);
let totalHour=Object.values(hourData).reduce((a,b)=>a+timeToDecimal(b),0);

let techProcessed=techRaw.map(t=>{
    let bd=timeToDecimal(t.bd);
    let corr=timeToDecimal(t.corr);
    let total=bd+corr;
    return {...t,bd,corr,total};
});
let totalTech=techProcessed.reduce((a,b)=>a+b.total,0);

techProcessed.sort((a,b)=>b.total-a.total);
let topTech=techProcessed[0];

/* ---------------- KPI ---------------- */
const kpis=[
{title:"Total Shift Hours",value:totalShift},
{title:"Total Area Hours",value:totalArea},
{title:"Total Hourly (549:38)",value:decimalToTime(totalHour)},
{title:"Total Technician Hours",value:decimalToTime(totalTech)},
{title:"Top Technician",value:topTech.name.toUpperCase()+" ("+decimalToTime(topTech.total)+")"}
];

document.getElementById("kpiCards").innerHTML=
kpis.map(k=>`
<div class="card">
<h3>${k.title}</h3>
<div class="value">${k.value}</div>
</div>
`).join("");

/* ---------------- CHARTS ---------------- */

new Chart(document.getElementById("shiftChart"),{
type:'doughnut',
data:{
labels:Object.keys(shiftData),
datasets:[{data:Object.values(shiftData)}]
}
});

new Chart(document.getElementById("areaChart"),{
type:'doughnut',
data:{
labels:Object.keys(areaData),
datasets:[{data:Object.values(areaData)}]
}
});

new Chart(document.getElementById("hourChart"),{
type:'bar',
data:{
labels:Object.keys(hourData),
datasets:[{
label:"Hourly Consumption",
data:Object.values(hourData).map(timeToDecimal)
}]
}
});

new Chart(document.getElementById("techStackChart"),{
type:'bar',
data:{
labels:techProcessed.map(t=>t.name),
datasets:[
{label:"Breakdown",data:techProcessed.map(t=>t.bd)},
{label:"Corrective",data:techProcessed.map(t=>t.corr)}
]
},
options:{responsive:true}
});

/* ---------------- TABLE ---------------- */
let table=`
<table>
<tr>
<th>Rank</th>
<th>Name</th>
<th>Total Hours</th>
<th>% Contribution</th>
<th>Breakdown %</th>
</tr>
`;

techProcessed.forEach((t,i)=>{
let contribution=(t.total/totalTech*100).toFixed(1);
let bdRatio=(t.bd/t.total*100).toFixed(1);
let cls="";
if(contribution>10) cls="highlight";
if(bdRatio>60) cls="warning";
table+=`
<tr class="${cls}">
<td>${i+1}</td>
<td>${t.name}</td>
<td>${decimalToTime(t.total)}</td>
<td>${contribution}%</td>
<td>${bdRatio}%</td>
</tr>
`;
});
table+="</table>";
document.getElementById("techTable").innerHTML=table;

/* ---------------- INSIGHTS ---------------- */
let insights=[];
if((topTech.total/totalTech*100)>15){
insights.push("⚠ High workload concentration on "+topTech.name);
}
let reactive=techProcessed.filter(t=>(t.bd/t.total)>0.6);
if(reactive.length>0){
insights.push("⚠ Reactive risk detected in "+reactive.map(r=>r.name).join(", "));
}
let peakHour=Object.entries(hourData).sort((a,b)=>timeToDecimal(b[1])-timeToDecimal(a[1]))[0];
insights.push("Peak hour: "+peakHour[0]+":00 with "+peakHour[1]+" hours");

document.getElementById("insightBox").innerHTML=insights.join("<br><br>");

</script>
</body>
</html>

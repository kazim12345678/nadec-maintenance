<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Maintenance KPI Dashboard</title>

<style>
:root{
  --p:#0b5f6a; --s:#2fa4b6; --bg:#f4f7f8; --c:#fff; --b:#d9e2e6;
}
*{box-sizing:border-box;font-family:Segoe UI,Arial}
body{margin:0;background:var(--bg)}
header{background:linear-gradient(90deg,var(--p),var(--s));color:#fff;padding:16px}
.container{padding:16px}
h2{font-size:16px;border-left:4px solid var(--s);padding-left:8px}

.kpis{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:12px}
.kpi{background:var(--c);padding:12px;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,.1)}
.kpi span{font-size:22px;font-weight:700;color:var(--p)}

.section{background:var(--c);padding:14px;margin-top:18px;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,.08)}

table{width:100%;border-collapse:collapse;font-size:12px}
th,td{border:1px solid var(--b);padding:5px;text-align:center}
th{background:#eef6f8}

input,select{width:100%;padding:4px;font-size:12px}
button{padding:6px 12px;background:var(--s);border:0;color:#fff;border-radius:4px;cursor:pointer}

canvas{width:100%;max-width:600px;height:250px}
.filter{margin:10px 0}
</style>
</head>

<body>

<header>
  <h1>Maintenance KPI Dashboard</h1>
  <p>Preventive & Breakdown Maintenance</p>
</header>

<div class="container">

<div class="filter">
Month:
<select id="monthFilter" onchange="renderAll()">
<option value="">All</option>
<option value="0">Jan</option><option value="1">Feb</option><option value="2">Mar</option>
<option value="3">Apr</option><option value="4">May</option><option value="5">Jun</option>
<option value="6">Jul</option><option value="7">Aug</option><option value="8">Sep</option>
<option value="9">Oct</option><option value="10">Nov</option><option value="11">Dec</option>
</select>
</div>

<!-- KPIs -->
<div class="kpis">
<div class="kpi">Breakdown Hours<br><span id="bdh">0</span></div>
<div class="kpi">PM Completion %<br><span id="pmc">0%</span></div>
<div class="kpi">MTTR<br><span id="mttr">0</span></div>
<div class="kpi">MTBF<br><span id="mtbf">0</span></div>
</div>

<!-- RAW DATA -->
<div class="section">
<h2>RAW_DATA</h2>
<table id="dataTable">
<tr>
<th>Date</th><th>Line</th><th>Machine</th><th>Type</th><th>Duration</th>
</tr>
</table>
<button onclick="addRow()">Add Row</button>
</div>

<!-- CHARTS -->
<div class="section">
<h2>Charts</h2>
<canvas id="chart1"></canvas>
<canvas id="chart2"></canvas>
</div>

</div>

<script>
let data = JSON.parse(localStorage.getItem("maintData")||"[]");

function addRow(){
  data.push({date:"",line:1,machine:"Filler",type:"Breakdown",dur:0});
  save(); renderTable();
}

function save(){ localStorage.setItem("maintData",JSON.stringify(data)); renderAll(); }

function renderTable(){
  let t=document.getElementById("dataTable");
  t.innerHTML=`<tr><th>Date</th><th>Line</th><th>Machine</th><th>Type</th><th>Duration</th></tr>`;
  data.forEach((r,i)=>{
    t.innerHTML+=`
    <tr>
    <td><input type="date" value="${r.date}" onchange="data[${i}].date=this.value;save()"></td>
    <td><input type="number" min="1" max="18" value="${r.line}" onchange="data[${i}].line=this.value;save()"></td>
    <td><select onchange="data[${i}].machine=this.value;save()">
      <option ${r.machine=="Filler"?"selected":""}>Filler</option>
      <option ${r.machine=="Labeller"?"selected":""}>Labeller</option>
      <option ${r.machine=="Packer"?"selected":""}>Packer</option>
    </select></td>
    <td><select onchange="data[${i}].type=this.value;save()">
      <option ${r.type=="Breakdown"?"selected":""}>Breakdown</option>
      <option ${r.type=="PM"?"selected":""}>PM</option>
    </select></td>
    <td><input type="number" step="0.1" value="${r.dur}" onchange="data[${i}].dur=this.value;save()"></td>
    </tr>`;
  });
}

function renderKPIs(){
  let m=document.getElementById("monthFilter").value;
  let f=data.filter(r=>!m||new Date(r.date).getMonth()==m);
  let bd=f.filter(r=>r.type=="Breakdown");
  let pm=f.filter(r=>r.type=="PM");
  let bdh=bd.reduce((a,b)=>a+Number(b.dur),0);
  document.getElementById("bdh").innerText=bdh.toFixed(1);
  document.getElementById("pmc").innerText=(pm.length/(pm.length+bd.length||1)*100).toFixed(0)+"%";
  document.getElementById("mttr").innerText=(bdh/(bd.length||1)).toFixed(2);
  document.getElementById("mtbf").innerText=((720-bdh)/(bd.length||1)).toFixed(1);
}

function drawBar(canvas,dataArr,label){
  let c=canvas.getContext("2d");
  c.clearRect(0,0,canvas.width,canvas.height);
  let max=Math.max(...dataArr,1);
  dataArr.forEach((v,i)=>{
    let h=(v/max)*200;
    c.fillStyle="#2fa4b6";
    c.fillRect(50+i*80,230-h,40,h);
    c.fillText(label[i],50+i*80,245);
  });
}

function renderCharts(){
  let m=document.getElementById("monthFilter").value;
  let f=data.filter(r=>!m||new Date(r.date).getMonth()==m);
  let bd=f.filter(r=>r.type=="Breakdown").reduce((a,b)=>a+Number(b.dur),0);
  let pm=f.filter(r=>r.type=="PM").reduce((a,b)=>a+Number(b.dur),0);
  drawBar(document.getElementById("chart1"),[bd],["Breakdown"]);
  drawBar(document.getElementById("chart2"),[pm,bd],["PM","BD"]);
}

function renderAll(){ renderKPIs(); renderCharts(); }

renderTable(); renderAll();
</script>

</body>
</html>

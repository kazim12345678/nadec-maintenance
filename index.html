<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Maintenance KPI Dashboard – 2026 Drinkable Line</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #f5f5f5;
    color: #333;
  }
  header {
    background: #007bbf;
    color: white;
    padding: 15px;
    text-align: center;
    font-size: 20px;
    font-weight: bold;
  }
  .container {
    padding: 15px;
  }
  .kpi-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 12px;
    margin-bottom: 20px;
  }
  .kpi-card {
    background: white;
    border-radius: 8px;
    padding: 12px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  }
  .kpi-card h4 {
    margin: 0;
    font-size: 13px;
    color: #666;
  }
  .kpi-card .value {
    font-size: 22px;
    font-weight: bold;
    margin-top: 6px;
    color: #007bbf;
  }
  .charts {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
  }
  .chart-box {
    background: white;
    padding: 12px;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  }
  h3 {
    margin-top: 0;
    font-size: 15px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 25px;
    background: white;
  }
  th, td {
    border: 1px solid #ccc;
    padding: 6px;
    font-size: 12px;
    text-align: center;
  }
  th {
    background: #007bbf;
    color: white;
    position: sticky;
    top: 0;
  }
  td[contenteditable="true"] {
    background: #fff;
  }
  td.edited {
    background: #fff9c4;
  }
  .table-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  button {
    background: #007bbf;
    color: white;
    border: none;
    padding: 6px 10px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 12px;
  }
  button:hover {
    opacity: 0.9;
  }
  .controls {
    margin-bottom: 15px;
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }
</style>
</head>

<body>
<header>Maintenance KPI Dashboard – 2026 Drinkable Line</header>

<div class="container">

<div class="controls">
  <button onclick="saveData()">Save Data</button>
  <button onclick="resetData()">Reset Data</button>
</div>

<!-- KPI CARDS -->
<div class="kpi-cards">
  <div class="kpi-card"><h4>Total Breakdown Hours</h4><div class="value" id="kpiBreakdown">0</div></div>
  <div class="kpi-card"><h4>Total Maintenance Cost (YTD)</h4><div class="value" id="kpiCost">0</div></div>
  <div class="kpi-card"><h4>PM vs BM Ratio</h4><div class="value" id="kpiPMBM">0 / 0</div></div>
  <div class="kpi-card"><h4>Total Failures YTD</h4><div class="value" id="kpiFailures">0</div></div>
  <div class="kpi-card"><h4>% Completed Maintenance</h4><div class="value" id="kpiCompleted">0%</div></div>
  <div class="kpi-card"><h4>Top Downtime Cause</h4><div class="value" id="kpiCause">-</div></div>
</div>

<!-- CHARTS -->
<div class="charts">
  <div class="chart-box"><h3>Breakdown Contribution</h3><canvas id="chartBreakdown"></canvas></div>
  <div class="chart-box"><h3>Maintenance Cost (Actual vs Budget)</h3><canvas id="chartCost"></canvas></div>
  <div class="chart-box"><h3>Maintenance Status</h3><canvas id="chartStatus"></canvas></div>
  <div class="chart-box"><h3>PM vs BM Manhours</h3><canvas id="chartPMBM"></canvas></div>
  <div class="chart-box"><h3>Downtime Causes</h3><canvas id="chartCauses"></canvas></div>
  <div class="chart-box"><h3>Failure Trend</h3><canvas id="chartFailures"></canvas></div>
</div>

<!-- TABLES -->

<h3>Breakdown Contribution Table</h3>
<table id="tblBreakdown">
<thead><tr><th>Line</th><th>Breakdown Hours</th><th>Contribution %</th></tr></thead>
<tbody>
<tr><td contenteditable>Line 1</td><td contenteditable>20</td><td></td></tr>
<tr><td contenteditable>Line 2</td><td contenteditable>15</td><td></td></tr>
<tr><td contenteditable>Line 3</td><td contenteditable>10</td><td></td></tr>
</tbody>
</table>

<h3>Maintenance Cost Table</h3>
<table id="tblCost">
<thead><tr><th>Month</th><th>Actual Cost</th><th>Budget Cost</th></tr></thead>
<tbody>
<tr><td contenteditable>Jan</td><td contenteditable>12000</td><td contenteditable>10000</td></tr>
<tr><td contenteditable>Feb</td><td contenteditable>9000</td><td contenteditable>10000</td></tr>
</tbody>
</table>

<h3>Maintenance Status Table</h3>
<table id="tblStatus">
<thead><tr><th>Status</th><th>Count</th></tr></thead>
<tbody>
<tr><td contenteditable>Scheduled</td><td contenteditable>120</td></tr>
<tr><td contenteditable>Completed</td><td contenteditable>100</td></tr>
<tr><td contenteditable>Overdue</td><td contenteditable>20</td></tr>
</tbody>
</table>

<h3>PM vs BM Manhour Table</h3>
<table id="tblPMBM">
<thead><tr><th>Month</th><th>PM Manhours</th><th>BM Manhours</th></tr></thead>
<tbody>
<tr><td contenteditable>Jan</td><td contenteditable>300</td><td contenteditable>200</td></tr>
<tr><td contenteditable>Feb</td><td contenteditable>280</td><td contenteditable>220</td></tr>
</tbody>
</table>

<h3>Downtime Causes Table</h3>
<table id="tblCauses">
<thead><tr><th>Cause</th><th>Percentage</th></tr></thead>
<tbody>
<tr><td contenteditable>M/C Breakdown</td><td contenteditable>40</td></tr>
<tr><td contenteditable>Missing Parts</td><td contenteditable>25</td></tr>
<tr><td contenteditable>Manpower</td><td contenteditable>20</td></tr>
<tr><td contenteditable>Other</td><td contenteditable>15</td></tr>
</tbody>
</table>

<h3>Failure Status Trend Table</h3>
<table id="tblFailures">
<thead><tr><th>Month</th><th>Failures</th></tr></thead>
<tbody>
<tr><td contenteditable>Jan</td><td contenteditable>12</td></tr>
<tr><td contenteditable>Feb</td><td contenteditable>9</td></tr>
</tbody>
</table>

</div>

<script>
let charts = {};

function parseTable(tableId) {
  const rows = [...document.querySelectorAll(`#${tableId} tbody tr`)];
  return rows.map(r => [...r.children].map(c => c.innerText.trim()));
}

function updateKPIs() {
  const breakdown = parseTable("tblBreakdown");
  const totalBD = breakdown.reduce((s,r)=>s+(+r[1]||0),0);
  breakdown.forEach((r,i)=>{
    const pct = totalBD ? ((+r[1]/totalBD)*100).toFixed(1) : 0;
    document.querySelectorAll("#tblBreakdown tbody tr")[i].children[2].innerText = pct;
  });
  document.getElementById("kpiBreakdown").innerText = totalBD;

  const cost = parseTable("tblCost").reduce((s,r)=>s+(+r[1]||0),0);
  document.getElementById("kpiCost").innerText = cost;

  const pmbm = parseTable("tblPMBM");
  const pm = pmbm.reduce((s,r)=>s+(+r[1]||0),0);
  const bm = pmbm.reduce((s,r)=>s+(+r[2]||0),0);
  document.getElementById("kpiPMBM").innerText = `PM ${Math.round(pm/(pm+bm)*100)||0}% / BM ${Math.round(bm/(pm+bm)*100)||0}%`;

  const failures = parseTable("tblFailures").reduce((s,r)=>s+(+r[1]||0),0);
  document.getElementById("kpiFailures").innerText = failures;

  const status = parseTable("tblStatus");
  const scheduled = +status.find(r=>r[0]==="Scheduled")?.[1]||0;
  const completed = +status.find(r=>r[0]==="Completed")?.[1]||0;
  document.getElementById("kpiCompleted").innerText = scheduled ? Math.round(completed/scheduled*100)+"%" : "0%";

  const causes = parseTable("tblCauses");
  let top = causes.sort((a,b)=>b[1]-a[1])[0];
  document.getElementById("kpiCause").innerText = top ? top[0] : "-";
}

function buildCharts() {
  if (Object.keys(charts).length) {
    Object.values(charts).forEach(c=>c.destroy());
  }

  const bd = parseTable("tblBreakdown");
  charts.bd = new Chart(chartBreakdown,{
    type:"bar",
    data:{labels:bd.map(r=>r[0]),datasets:[{data:bd.map(r=>+r[1]),backgroundColor:"#007bbf"}]}
  });

  const cost = parseTable("tblCost");
  charts.cost = new Chart(chartCost,{
    type:"bar",
    data:{
      labels:cost.map(r=>r[0]),
      datasets:[
        {label:"Actual",data:cost.map(r=>+r[1]),backgroundColor:"#007bbf"},
        {label:"Budget",data:cost.map(r=>+r[2]),backgroundColor:"#90caf9"}
      ]
    }
  });

  const status = parseTable("tblStatus");
  charts.status = new Chart(chartStatus,{
    type:"doughnut",
    data:{labels:status.map(r=>r[0]),datasets:[{data:status.map(r=>+r[1]),backgroundColor:["#007bbf","#4caf50","#f44336"]}]}
  });

  const pmbm = parseTable("tblPMBM");
  charts.pmbm = new Chart(chartPMBM,{
    type:"bar",
    data:{
      labels:pmbm.map(r=>r[0]),
      datasets:[
        {label:"PM",data:pmbm.map(r=>+r[1]),backgroundColor:"#007bbf"},
        {label:"BM",data:pmbm.map(r=>+r[2]),backgroundColor:"#ff9800"}
      ]
    }
  });

  const causes = parseTable("tblCauses");
  charts.causes = new Chart(chartCauses,{
    type:"pie",
    data:{labels:causes.map(r=>r[0]),datasets:[{data:causes.map(r=>+r[1]),backgroundColor:["#007bbf","#ff9800","#4caf50","#9e9e9e"]}]}
  });

  const fail = parseTable("tblFailures");
  charts.fail = new Chart(chartFailures,{
    type:"line",
    data:{labels:fail.map(r=>r[0]),datasets:[{data:fail.map(r=>+r[1]),borderColor:"#007bbf",fill:false}]}
  });
}

function attachListeners() {
  document.querySelectorAll("td[contenteditable]").forEach(td=>{
    td.addEventListener("input",()=>{
      td.classList.add("edited");
      updateAll();
    });
  });
}

function updateAll() {
  updateKPIs();
  buildCharts();
}

function saveData() {
  const tables = document.querySelectorAll("table");
  const data = {};
  tables.forEach(t=>data[t.id]=t.innerHTML);
  localStorage.setItem("kpiData",JSON.stringify(data));
  alert("Data saved");
}

function resetData() {
  localStorage.removeItem("kpiData");
  location.reload();
}

(function init(){
  const saved = localStorage.getItem("kpiData");
  if(saved){
    const data = JSON.parse(saved);
    Object.keys(data).forEach(id=>{
      document.getElementById(id).innerHTML = data[id];
    });
  }
  attachListeners();
  updateAll();
})();
</script>

</body>
</html>
